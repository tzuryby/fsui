{% extends "base.html" %}

{% block body %}

<center>
    <div class="hide_on_load ui-corner-all" id="notification_div">
        <p id="notification_message">
        </p>
    </div>
</center>
<div id="main_tabs">
	<ul>
		<li><a href="#tabs-dashboard">{{_("Dashboard")}}</a></li>
		<li><a href="#tabs-conference">{{_("Confenernces")}}</a></li>
		<li><a href="#tabs-cli">{{_("CLI")}}</a></li>
		<li><a href="#tabs-diagnostics">{{_("Diagnostics")}}</a></li>
		<li><a href="#tabs-settings">{{_("Settings")}}</a></li>
	</ul>
	<div id="tabs-dashboard">
        <div id="dashboard-users"></div>
    </div>
	<div id="tabs-conference">Comming Soon...</div>
	<div id="tabs-cli">
        <input 
            id="cli-input" type="text" placeholder='{{_("Enter FS CLI command")}}' 
            class="wide-input ui-widget-content ui-corner-all" />
        <div id="cli-output"></div>
    </div>
	<div id="tabs-diagnostics">Comming Soon...</div>
	<div id="tabs-settings">Comming Soon...</div>
</div>

<script type="text/javascript">

$(document).ready(function(){
    
    // in case someone decided to use IE6 -- LULZec come over here ;-)
    window.console = window.console || {log: function(){}}
    
    // tabify dashboard
    $("#main_tabs").tabs({ cookie: { expires: 30 } });
    
    
    // bind cli interaction
    $("#cli-input").keypress(
        function(evt){
            var keyCode = evt.keyCode;        
            if (keyCode === 13){
                var user_input = $(this).val();
                var xcommand =  user_input || "sofia status profile internal"
                if (!user_input)
                    $(this).val(xcommand);
                    
                var url = "/cli", 
                    params = {"x": xcommand};
                    
                $("#cli-output").load(url, params);
                $("#cli-output").css("height", "70%");
            }
        }
    );
    
    dashBoard = {    
        loopId:    0,
        uiHandler: function(){
            $(".hideme").hide();
            var more_info_button_selector = $(".moreinfo-qtip");
            
            more_info_button_selector
                .each(function(){
                    $(this).qtip({
                         content: {
                            text: $("#tip_frame_" + $(this).attr("rel")),
                            title: {
                               text: '{{_("More Info")}}',
                               button: 'x' 
                            }
                         },
                         position: {
                            corner: { target: 'bottomLeft', tooltip: 'topMiddle'},
                            adjust: { screen: true }
                         },
                         show: { when: 'click', solo: true },
                         hide: 'unfocus',
                         style: {
                            tip: true, 
                            border: {
                               width: 0,
                               radius: 4
                            },
                            name: 'light', 
                            width: 220 
                         },
                         api: {
                            onShow: function(e){
                                dashBoard.stopLoop();
                            },
                            onHide: function(e){
                                dashBoard.startLoop()
                            }
                        }
                  });
                });
            
        }, 
        loader:    function(){ $("#dashboard-users").load("/dashboard", dashBoard.uiHandler);},
        startLoop: function(){ dashBoard.loopId = window.setInterval(dashBoard.loader, 8*1000) },
        stopLoop:  function(){ dashBoard.loopId && window.clearInterval(dashBoard.loopId);}
    }
    
    dashBoard.loader();
    dashBoard.startLoop();
    
    //~ $("#watch-fs-log").click(function(){
        //~ window.open('/fslog','logdmp','width=580,height=600');
    //~ });    
    
    //~ $("button").button();
    
});


</script>

{% end %}



